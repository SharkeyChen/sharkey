(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c0be216a"],{"3f113":function(t,i,s){},"4a88":function(t,i,s){"use strict";var e=s("ab00"),r=s.n(e);r.a},"55de":function(t,i,s){"use strict";s.r(i);var e=function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",[s("div",{staticStyle:{overflow:"hidden"}},[s("div",{staticClass:"user-info-label",staticStyle:{float:"left"}},[t._m(0),s("img",{staticClass:"round_icon",attrs:{src:this.$StaticImage+t.myinfo.profile,alt:"我的头像"}}),s("div",{staticClass:"name-label"},[s("span",[t._v(t._s(t.myinfo.nickname))])]),s("div",{staticStyle:{"text-align":"center"}},[1==t.me?s("img",{attrs:{src:this.$StaticImage+this.turnImg}}):t._e()])]),s("div",{staticStyle:{float:"left",height:"100px","padding-top":"50px","margin-left":"100px","vertical-align":"center"}},[s("div",{staticStyle:{float:"left"}},[t._v(t._s(t.myready))]),s("img",{staticStyle:{width:"150px",height:"120px",float:"left"},attrs:{src:this.$StaticImage+this.vsImg,alt:"对决"}}),s("div",{staticStyle:{float:"left"}},[t._v(t._s(t.yourready))])]),s("div",{staticClass:"user-info-label",staticStyle:{float:"right"}},[t._m(1),s("img",{staticClass:"round_icon",attrs:{src:this.$StaticImage+t.yourinfo.profile,alt:"对方的头像"}}),s("div",{staticClass:"name-label"},[s("span",[t._v(t._s(t.yourinfo.nickname))])]),s("div",{staticStyle:{"text-align":"center"}},[0==t.me?s("img",{attrs:{src:this.$StaticImage+this.turnImg}}):t._e()])])]),s("div",{staticStyle:{overflow:"hidden","margin-top":"20px"}},[s("div",{staticStyle:{float:"left","margin-left":"300px"}},[s("canvas",{ref:"chess",attrs:{width:"600",height:"600"},on:{click:t.chessClick}})]),s("div",{staticStyle:{float:"right","margin-right":"100px"}},[s("ChatRoom",{attrs:{myinfo:t.myinfo,yourinfo:t.yourinfo,chatrecord:t.chatrecord,roomid:t.roomid},on:{func:t.chatSendMessage}})],1)]),s("div",{staticStyle:{"text-align":"center"}},[s("el-button",{attrs:{round:"",disabled:t.btnable},on:{click:t.ReadytoPlay}},[t._v("准备")]),s("el-button",{attrs:{round:""},on:{click:t.BacktoHome}},[t._v("退出")])],1)])},r=[function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",{staticClass:"name-label"},[s("span",[t._v("你")])])},function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",{staticClass:"name-label"},[s("span",[t._v("对手")])])}],o=(s("56ea"),s("e35a"),s("0d7a"),s("e769")),a=s("b705"),n=function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",{staticClass:"talk_con2"},[s("div",{staticClass:"talk_show",attrs:{id:"words"}},t._l(t.chatrecord,(function(i){return s("div",{class:i.person==t.myinfo.username?"atalk":"btalk"},[s("span",[t._v(t._s(i.person)+"说："+t._s(i.words))])])})),0),s("div",{staticClass:"talk_input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.words,expression:"words"}],staticClass:"talk_word",attrs:{type:"text"},domProps:{value:t.words},on:{keyup:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"enter",13,i.key,"Enter")?null:t.sendMsg(i)},input:function(i){i.target.composing||(t.words=i.target.value)}}}),s("el-button",{staticStyle:{float:"right"},on:{click:t.sendMsg}},[t._v("发送")])],1)])},h=[],c={name:"ChatRoom",props:{roomid:String,myinfo:Object,yourinfo:Object,chatrecord:Array},data:function(){return{words:""}},methods:{sendMsg:function(){if(""!=this.words&&""!=this.yourinfo.username){var t={rid:this.roomid,person:this.myinfo.username,words:this.words};this.$emit("func",t)}this.words=""},scrollButton:function(){this.$nextTick((function(){var t=document.getElementById("words");t.scrollTop=t.scrollHeight}))}},watch:{chatrecord:{deep:!0,handler:function(t,i){console.log("newValue",t),console.log("oldValue",i),this.scrollButton()}}}},d=c,l=(s("4a88"),s("4023")),f=Object(l["a"])(d,n,h,!1,null,"2fa42e30",null),u=f.exports,m={name:"Bang",components:{ChatRoom:u},data:function(){return{chess:{},context:{},chessBoard:[],me:!1,color:-1,count:0,over:!1,vsImg:"/images/chess-VS.jpg",turnImg:"/images/arrow-turn.svg",myinfo:{profile:"/images/no-profile.jpg",nickname:"暂无",username:""},roomid:"",yourinfo:{profile:"/images/no-profile.jpg",nickname:"暂无",username:""},chatrecord:[],param:{},step:{},beforeStep:{},myready:"未准备",yourready:"未准备",btnable:!1,chesssize:15,gridsize:40,chesswidth:0}},mounted:function(){this.chesswidth=this.chesssize*this.gridsize,this.init(),this.getUserInfo()},methods:{init:function(){this.chess=this.$refs.chess,this.initChessBoard(),this.roomid=window.location.href.split("=")[1]},initChessBoard:function(){var t=this;this.over=!1,this.context=this.chess.getContext("2d"),this.context.height=this.chess.height,this.drawImage((function(i){t.drawChessBoard()})),this.fillArray(),this.beforeStep={x:-1,y:-1}},fillArray:function(){for(var t=0;t<this.chesssize;t++){this.chessBoard[t]=[];for(var i=0;i<this.chesssize;i++)this.chessBoard[t][i]=0}},drawImage:function(t){var i=this,s=this.context;s.fillStyle="rgb(213,176,146)",s.fillRect(0,0,this.chesswidth,this.chesswidth),s.stroke();var e=new Image;e.src=this.$StaticImage+"/images/chess-bg.svg",e.onload=function(r){s.drawImage(e,(i.chesswidth-e.width)/2,(i.chesswidth-e.height)/2,e.width,e.height),t()}},drawChessBoard:function(){var t=this.context;t.strokeStyle="#2b2b2b";for(var i=0;i<this.chesssize;i++)t.moveTo(this.gridsize/2+i*this.gridsize,this.gridsize/2),t.lineTo(this.gridsize/2+i*this.gridsize,this.chesswidth-this.gridsize/2),t.stroke(),t.moveTo(this.gridsize/2,this.gridsize/2+i*this.gridsize),t.lineTo(this.chesswidth-this.gridsize/2,this.gridsize/2+i*this.gridsize),t.stroke()},EmptyStep:function(){this.step={player:"",coordinate:{},color:-1}},EmptyParam:function(){this.param={}},SetStep:function(t,i,s){null!=t&&null!=i&&null!=s&&(this.step.player=t,this.step.coordinate=i,this.step.color=s)},chessClick:function(t){if(!this.over&&this.me){var i=t.offsetX,s=t.offsetY,e=Math.floor(i/this.gridsize),r=Math.floor(s/this.gridsize);if(0==this.chessBoard[e][r]){var o={x:e,y:r};this.SetStep(this.myinfo.username,o,this.color),this.step.rid=this.roomid,this.setParam(1004,this.step),this.$ws.dispatch("WEBSOCKET_SEND",JSON.stringify(this.param))}}},onStep:function(t,i,s){var e=t.x,r=t.y;this.chessBoard[e][r]=i;var o=this.context;o.beginPath(),o.arc(this.gridsize/2+e*this.gridsize,this.gridsize/2+r*this.gridsize,s,0,2*Math.PI),o.closePath();var a=o.createRadialGradient(this.gridsize/2+e*this.gridsize+2,this.gridsize/2+r*this.gridsize-2,13,this.gridsize/2+e*this.gridsize+2,this.gridsize/2+r*this.gridsize-2,0);1==i?(a.addColorStop(0,"#0a0a0a"),a.addColorStop(1,"#636766")):2==i&&(a.addColorStop(0,"#d1d1d1"),a.addColorStop(1,"#f9f9f9")),o.fillStyle=a,o.fill()},circleChess:function(t){var i=t.x,s=t.y,e=this.context;e.strokeStyle="#ff3c3e",e.arc(this.gridsize/2+i*this.gridsize,this.gridsize/2+s*this.gridsize,this.gridsize/2-2,0,2*Math.PI),e.stroke()},changeBeforeStep:function(t){if(-1!=this.beforeStep.x&&-1!=this.beforeStep.y){var i=this.context,s=this.beforeStep.x,e=this.beforeStep.y;i.clearRect(s*this.gridsize,e*this.gridsize,this.gridsize,this.gridsize),i.fillStyle="rgb(213,176,146)",i.fillRect(s*this.gridsize,e*this.gridsize,this.gridsize,this.gridsize),this.onStep(this.beforeStep,this.chessBoard[this.beforeStep.x][this.beforeStep.y],this.gridsize/2-3)}this.beforeStep=t},checkOver:function(t,i){for(var s=t.x,e=t.y,r=s<4?0:s-4,o=s>10?14:s+4,a=0,n=r;n<=o;n++)if(this.chessBoard[n][e]==i?a++:a=0,5==a)return this.over=!0,!0;var h=e<4?0:e-4,c=e>10?14:e+4;a=0;for(var d=h;d<=c;d++)if(this.chessBoard[s][d]==i?a++:a=0,5==a)return this.over=!0,!0;r=s-4,h=e-4,o=s+4,c=e+4,a=0;for(var l=r,f=h;l<=o&&f<=c;l++,f++)if(!(l<0||f<0||l>14||f>14)&&(this.chessBoard[l][f]==i?a++:a=0,5==a))return this.over=!0,!0;r=s-4,h=e+4,o=s+4,c=e-4,a=0;for(var u=r,m=h;u<=o&&m>=c;u++,m--)if(!(u<0||m<0||u>14||m>14)&&(this.chessBoard[u][m]==i?a++:a=0,5==a))return this.over=!0,!0;return!1},getUserInfo:function(){var t=this,i=window.sessionStorage.getItem("user");if(null==i)return window.sessionStorage.removeItem("user"),void this.$router.push("/");var s="/user/?username="+i;this.getRequest(s).then((function(i){t.myinfo=i;var s={id:t.myinfo.username,rid:t.roomid};t.setParam(1e3,s),t.$ws.dispatch("WEBSOCKET_SEND",JSON.stringify(t.param))}))},setParam:function(t,i){for(var s in this.EmptyParam(),this.param.code=t,i)this.param[s]=i[s]},isJSON:function(t){if("string"!=typeof t)return!1;try{var i=JSON.parse(t);return!("object"!=Object(o["a"])(i)||!i)}catch(s){return console.log("error："+t+"!!!"+s),!1}},ReadytoPlay:function(){this.setParam(1002,{rid:this.roomid,id:this.myinfo.username}),this.$ws.dispatch("WEBSOCKET_SEND",JSON.stringify(this.param))},chatSendMessage:function(t){this.setParam(1005,t),this.$ws.dispatch("WEBSOCKET_SEND",JSON.stringify(this.param))},BacktoHome:function(){this.setParam(1050,{rid:this.roomid,id:this.myinfo.username}),this.$ws.dispatch("WEBSOCKET_SEND",JSON.stringify(this.param))}},computed:{alertCon:function(){return this.$ws.getters.onEvent("string")}},watch:{alertCon:function(t,i){var s=this;if(t!=i&&t&&(console.log(t),this.isJSON(t))){var e=JSON.parse(t);if(1001==e.code){var r="";if(r=e.players[0]==this.myinfo.username?e.players[1]:e.players[0],!r||null==r)return;var o="/user/?username="+r;this.getRequest(o).then((function(t){t&&(s.yourinfo=t)}))}else if(1002==e.code)e.id==this.yourinfo.username?this.yourready="已准备":e.id==this.myinfo.username&&(this.myready="已准备",this.btnable=!0);else if(1003==e.code)e.players[0]==this.myinfo.username?(this.me=!0,this.color=1):(this.me=!1,this.color=2),this.myready="正在对局",this.yourready="正在对局",this.initChessBoard();else if(1004==e.code){if(this.onStep(e.coordinate,e.color,this.gridsize/2-3),this.circleChess(e.coordinate),this.changeBeforeStep(e.coordinate),e.player!=this.myinfo.username){if(this.checkOver(e.coordinate,e.color))return a["Message"].error("你输了，呜呜呜┭┮﹏┭┮"),this.setParam(1006,{rid:this.roomid,id:this.myinfo.username}),this.$ws.dispatch("WEBSOCKET_SEND",JSON.stringify(this.param)),this.myready="未准备",this.yourready="未准备",void(this.btnable=!1);this.me=!0}else if(e.player==this.myinfo.username){if(this.checkOver(e.coordinate,e.color))return a["Message"].success("你获胜啦~~~~~~~~"),this.setParam(1006,{rid:this.roomid,id:this.myinfo.username}),this.$ws.dispatch("WEBSOCKET_SEND",JSON.stringify(this.param)),this.myready="未准备",this.yourready="未准备",void(this.btnable=!1);this.me=!1}}else 1005==e.code?this.chatrecord.push(e):1050==e.code&&(e.id==this.myinfo.username?a["Message"].info("你已经退出房间"):e.id==this.yourinfo.username&&a["Message"].info(e.id+"已经退出房间，你也退出房间了"),this.$router.push("/blog"))}}}},g=m,p=(s("5fce"),Object(l["a"])(g,e,r,!1,null,"0248338a",null));i["default"]=p.exports},"56ea":function(t,i,s){var e=s("1c8b"),r=s("fa41"),o=s("258f");e({target:"Array",proto:!0},{fill:r}),o("fill")},"5fce":function(t,i,s){"use strict";var e=s("3f113"),r=s.n(e);r.a},ab00:function(t,i,s){},fa41:function(t,i,s){"use strict";var e=s("3553"),r=s("e1d6"),o=s("d88d");t.exports=function(t){var i=e(this),s=o(i.length),a=arguments.length,n=r(a>1?arguments[1]:void 0,s),h=a>2?arguments[2]:void 0,c=void 0===h?s:r(h,s);while(c>n)i[n++]=t;return i}}}]);
//# sourceMappingURL=chunk-c0be216a.b58e6067.js.map